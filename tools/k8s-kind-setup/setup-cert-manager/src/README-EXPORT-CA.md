# Экспорт корневого CA сертификата

Скрипт `export-root-ca.sh` предназначен для экспорта корневого CA сертификата из Kubernetes кластера и предоставления инструкций по его установке в браузеры и операционные системы.

## Проблема

При доступе к сервисам через HTTPS (например, `https://dashboard.prod.local`) браузер может показывать ошибку безопасности:

```
Ваше подключение не является закрытым
Злоумышленники могут пытаться украсть ваши данные (например, пароли, сообщения или номера кредитных карт) с dashboard.prod.local.
net::ERR_CERT_AUTHORITY_INVALID
```

Это происходит потому, что кластер использует самоподписанные сертификаты, которые не доверены браузером по умолчанию.

## Решение

Для решения этой проблемы необходимо экспортировать корневой CA сертификат и добавить его в доверенные сертификаты браузера.

## Использование

```bash
# Экспорт корневого CA сертификата
./export-root-ca.sh
```

Скрипт выполняет следующие действия:
1. Проверяет доступность кластера Kubernetes
2. Создает директорию для сертификатов (`~/zakenak-certs`)
3. Проверяет наличие секрета с корневым CA в namespace `prod`
4. Экспортирует корневой CA сертификат в файл `~/zakenak-certs/zakenak-root-ca.crt`
5. Выводит инструкции по установке сертификата в различных браузерах и операционных системах

## Инструкции по установке сертификата

### Chrome/Edge (Windows)
1. Откройте настройки браузера
2. Перейдите в 'Конфиденциальность и безопасность' -> 'Безопасность' -> 'Управление сертификатами'
3. Перейдите на вкладку 'Доверенные корневые центры сертификации'
4. Нажмите 'Импорт' и следуйте инструкциям мастера импорта сертификатов
5. Выберите файл `~/zakenak-certs/zakenak-root-ca.crt`
6. Перезапустите браузер

### Chrome/Edge (macOS)
1. Откройте 'Связка ключей'
2. Перетащите файл `~/zakenak-certs/zakenak-root-ca.crt` в список сертификатов
3. Дважды щелкните на импортированном сертификате
4. Разверните секцию 'Доверие' и выберите 'Всегда доверять'
5. Закройте окно и введите пароль администратора
6. Перезапустите браузер

### Firefox
1. Откройте настройки Firefox
2. Перейдите в 'Конфиденциальность и защита' -> 'Сертификаты' -> 'Просмотр сертификатов'
3. Перейдите на вкладку 'Центры сертификации'
4. Нажмите 'Импортировать' и выберите файл `~/zakenak-certs/zakenak-root-ca.crt`
5. Отметьте 'Доверять этому CA при идентификации веб-сайтов'
6. Нажмите 'OK' и перезапустите браузер

### Linux (Ubuntu/Debian)
1. Скопируйте сертификат в директорию доверенных CA:
   ```bash
   sudo cp ~/zakenak-certs/zakenak-root-ca.crt /usr/local/share/ca-certificates/zakenak-root-ca.crt
   ```
2. Обновите хранилище сертификатов:
   ```bash
   sudo update-ca-certificates
   ```
3. Перезапустите браузер

## Примечание

Этот сертификат действителен только для локальной разработки. Не импортируйте его в браузеры, используемые для доступа к важным сайтам.

## Устранение неполадок

### Сертификат не найден
Если скрипт не может найти секрет с корневым CA, убедитесь, что:
1. Чарт local-ca установлен в namespace `prod`
2. Секрет `root-ca-key-pair` существует в namespace `prod`

Вы можете проверить это с помощью команд:
```bash
kubectl get secret root-ca-key-pair -n prod
kubectl describe secret root-ca-key-pair -n prod
```

### Ошибка при экспорте сертификата
Если возникает ошибка при экспорте сертификата, убедитесь, что:
1. У вас есть права на создание директории `~/zakenak-certs`
2. У вас есть права на запись в директорию `~/zakenak-certs`
3. У вас есть доступ к кластеру Kubernetes

### Сертификат не работает
Если после установки сертификата браузер все еще показывает ошибку безопасности, убедитесь, что:
1. Вы установили сертификат в правильное хранилище
2. Вы перезапустили браузер после установки сертификата
3. Домен в адресной строке соответствует домену в сертификате (например, `dashboard.prod.local`)