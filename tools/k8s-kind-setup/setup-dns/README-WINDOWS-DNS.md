# Windows DNS Configuration for Kubernetes Dashboard

## Проблема

При попытке открыть Kubernetes Dashboard из Windows 11 по адресу `dashboard.prod.local` возникает ошибка:

```
Не удается открыть эту страницу
Похоже, dashboard.prod.local соединение закрыто.
Попробуйте:

Проверка подключения
Проверка прокси-сервера и брандмауэра
ERR_CONNECTION_CLOSED
```

При этом, в WSL Linux dashboard по адресу `dashboard.prod.local` работает корректно.

## Причина проблемы

Проблема возникает из-за того, что домен `dashboard.prod.local` настроен только внутри WSL и Kubernetes кластера, но не в Windows. Windows не знает, как разрешить этот домен в IP-адрес.

В WSL Linux домен `dashboard.prod.local` разрешается через CoreDNS в Kubernetes кластере, который настроен на перенаправление запросов к этому домену на IP-адрес ingress-контроллера.

## Решение

Для решения проблемы необходимо добавить записи в файл hosts Windows, чтобы домены `.prod.local` разрешались в IP-адрес WSL2.

### Автоматическое решение

Мы подготовили скрипты для автоматического обновления файла hosts в Windows:

1. Из WSL выполните:

```bash
./update-windows-dns.sh
```

Скрипт скопирует PowerShell скрипт в Windows и попытается запустить его с правами администратора. Вам может потребоваться подтвердить запуск с повышенными привилегиями.

2. Если автоматический запуск не сработал, выполните следующие шаги вручную:
   - Откройте PowerShell от имени администратора в Windows
   - Выполните команду, которую выведет скрипт `update-windows-dns.sh`

### Ручное решение

Если вы предпочитаете настроить файл hosts вручную:

1. Откройте PowerShell от имени администратора в Windows
2. Определите IP-адрес WSL2:
   ```powershell
   wsl hostname -I
   ```
3. Откройте файл hosts в Блокноте:
   ```powershell
   notepad C:\Windows\System32\drivers\etc\hosts
   ```
4. Добавьте следующие строки, заменив `<WSL_IP>` на полученный IP-адрес:
   ```
   <WSL_IP> dashboard.prod.local
   <WSL_IP> ollama.prod.local
   <WSL_IP> webui.prod.local
   ```
5. Сохраните файл
6. Очистите DNS-кеш:
   ```powershell
   ipconfig /flushdns
   ```

## Проверка

После обновления файла hosts, вы должны иметь возможность открыть:
- https://dashboard.prod.local
- https://ollama.prod.local
- https://webui.prod.local

## Устранение неполадок

### Проблема: IP-адрес WSL2 изменился

WSL2 может получать новый IP-адрес при перезапуске. Если вы снова не можете получить доступ к сервисам, повторите процедуру обновления файла hosts.

### Проблема: Доступ по HTTPS не работает

Если вы видите предупреждение о безопасности в браузере:
1. Это нормально, так как используются самоподписанные сертификаты
2. Нажмите "Дополнительно" и "Продолжить" (в Chrome/Edge) или добавьте исключение безопасности (в Firefox)

### Проблема: Не удается сохранить файл hosts

Если вы не можете сохранить файл hosts даже с правами администратора:
1. Скопируйте содержимое файла hosts в новый документ
2. Сохраните новый документ в другом месте
3. Закройте Блокнот
4. Скопируйте новый файл поверх оригинального через командную строку:
   ```powershell
   copy /Y C:\path\to\new\hosts C:\Windows\System32\drivers\etc\hosts
   ```

## Дополнительная информация

Для более подробной информации о настройке сети между Windows и WSL2 см. [документацию по настройке сети](/docs/NETWORK-CONFIGURATION.md).